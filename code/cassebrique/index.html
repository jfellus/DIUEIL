<html>
<head>
  <script src="../../js/jquery.js"></script>
  <style>
  svg { border:1px solid black; }

  #bar { fill:black; stroke:none; }

  h1 { display:none; }
  </style>

  <script>

  BW = 100
  vx = 3
  vy = 3
  function step() {
    x = parseInt($("#ball").attr("cx"))
    y = parseInt($("#ball").attr("cy"))
    x += vx
    y += vy

    if(x>=800-20 || x<=20) rebond_h() // Rebond bors
    if(y>=600-20-10 && x>=barx && x<=barx+BW) rebond_v() // Rebond barre
    if(vx>0 && y>=600-20-10 && (x+20>=barx && x<=barx)) rebond_hv()
    if(vx<0 && y>=600-20-10 && (x-20<=barx+BW && x>=barx+BW)) rebond_hv()
    if(vx>0 && y>=600-20-10 && (x-20<=barx+BW && x>=barx+BW)) rebond_v()
    if(vx<0 && y>=600-20-10 && (x+20>=barx && x<=barx)) rebond_v()
    if(y<=20) rebond_v() // Rebond haut
    if(y>=600-20) perdu()

    $("#ball").attr("cx", x).attr("cy", y)
  }

  function rebond_v() { vy = -vy }
  function rebond_h() { vx = -vx }
  function rebond_hv() { vy = -vy; vx = -vx }

  function perdu() {
    clearInterval(_i)
    $("#msg").text("YOU LOOSE !").show()
  }

  barx=0
  $(function() {
    svg = $("svg")

    $("#bar").attr("width", BW)

    svg.on('mousemove', (e) => {
      barx = e.offsetX
      if(barx>=800-BW) barx = 800-BW
      $("#bar").attr("x", barx)
    })

    _i = setInterval(step, 10)
  })

  </script>
</head>
<body>
<svg width=800px height=600px>
  <rect id="bar" x=0 y=590 width=40 height=10></rect>
  <circle id="ball" cx=400 cy=300 r=20></circle>
</svg>
<h1 id="msg"></h1>
</body>
</html>
